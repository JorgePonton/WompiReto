# Gradle
# Build your Java project and run tests with Gradle using a Gradle wrapper script.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- script: chmod +x ./gradlew

- script: |
    # Descargar ChromeDriver
    CHROMEDRIVER_URL="https://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip"
    wget $CHROMEDRIVER_URL -O chromedriver.zip
    unzip chromedriver.zip
    echo "export webdriver.chrome.driver=$(Agent.BuildDirectory)/s/chromedriver" >> $(Agent.TempDirectory)/chromedriver-env
  displayName: 'Download and configure ChromeDriver'

- script: |
    javac MyChromeDriver.java  # Compilar tu clase si es necesario
    . $(Agent.TempDirectory)/chromedriver-env  # Usar el punto en lugar de source
    java MyChromeDriver        # Ejecutar tu clase
  displayName: 'Run ChromeDriver'

- script: |
    . $(Agent.TempDirectory)/chromedriver-env  # Usar el punto en lugar de source
    java -jar YourTestProject.jar
  displayName: 'Run Tests'

- task: JavaToolInstaller@0
  inputs:
    versionSpec: '17'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'

- task: Gradle@3
  inputs:
    gradleWrapperFile: 'gradlew'
    tasks: 'build'
    publishJUnitResults: false
    codeCoverageClassFilesDirectories: 'build/classes/main/'
    javaHomeOption: 'JDKVersion'
    sonarQubeRunAnalysis: true
    sqGradlePluginVersionChoice: 'specify'
    sonarQubeGradlePluginVersion: '2.6.1'
    spotBugsAnalysis: false